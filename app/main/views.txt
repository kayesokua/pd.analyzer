from flask import Blueprint, request, render_template, url_for, redirect, send_file,json

from services.converter_video import *
from services.converter_gif import *
from services.pose_landmarker import *
from services.pose_recognition import *
from services.data_visualization import *

import pandas as pd

import os

bp = Blueprint("main", __name__, url_prefix="/")

@bp.route('/dictionary')
def main_dictionary():
    filepath = os.path.join('data', 'external', 'combined_dictionary.csv')
    try:
        df = pd.read_csv(filepath)
        images = df['filename'].tolist()
        plot_images = df['plot_filename'].tolist()
        annotated_images = df['annotated_filename'].tolist()
        posenames = df['posename'].tolist()
        orientations = df['orientation'].tolist()
        categories = df['category'].tolist()
        pose_data = zip(images, plot_images, annotated_images, posenames, orientations, categories)
        return render_template('layout_dictionary.html', pose_data=pose_data,  page=request.path,  page_title="Beginner Poses")
    
    except Exception as e:
        return f"An error occurred: {e}"
    
@bp.route('/dictionary/table')
def main_dictionary_tabular():
    filepath = os.path.join('data', 'external', 'combined_dictionary.csv')
    try:
        df = pd.read_csv(filepath)
        pose_results = df.to_dict(orient='records')
        return render_template('layout_dictionary_tabular.html',results=pose_results, page=request.path, page_title="Dictionary Results")
    except Exception as e:
        return f"An error occurred: {e}"

@bp.route('/about')
def main_about():
    return render_template("about.html", page_title="About Pole Dance AI Research")

@bp.route('/terms-and-conditions')
def main_terms_and_conditions():
    return render_template("terms.html", page_title="Terms and Conditions")

@bp.route('/disclaimer')
def main_page_disclaimer():
    return render_template("disclaimer.html", page_title="Disclaimer")